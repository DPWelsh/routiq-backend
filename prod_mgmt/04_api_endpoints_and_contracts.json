{
  "step": "04_api_endpoints_and_contracts",
  "title": "API Endpoints & Contracts",
  "purpose": "Understand what APIs are available and how they work",
  "estimated_time": "60 minutes",
  
  "tasks": [
    {
      "task": "Catalog all API endpoints",
      "files_to_review": [
        "src/api/main.py",
        "src/api/patients.py",
        "src/api/auth.py",
        "src/api/admin.py",
        "src/api/sync_manager.py",
        "src/api/conversations.py"
      ],
      "endpoint_categories": {
        "patient_management": [
          "GET /{org_id}/patients - List patients",
          "GET /{org_id}/patients/with-appointments - Detailed view",
          "GET /{org_id}/patients/by-appointment-type/{type} - Filtered list",
          "GET /{org_id}/patients/appointment-types/summary - Analytics"
        ],
        "sync_operations": [
          "POST /sync/{org_id}/cliniko/active-patients - Trigger sync",
          "GET /sync/{org_id}/status - Check sync status"
        ],
        "authentication": [
          "GET /auth/me - Get current user",
          "Various auth middleware endpoints"
        ],
        "administration": [
          "Health checks",
          "System status endpoints"
        ]
      }
    },
    {
      "task": "Understand request/response patterns",
      "patterns_to_analyze": [
        "Authentication headers (x-organization-id)",
        "Error response formats",
        "Pagination patterns",
        "Data filtering approaches"
      ],
      "sample_responses": [
        "Patient list response structure",
        "Error message formats",
        "Sync status response"
      ]
    },
    {
      "task": "Test API endpoints in production",
      "production_testing": [
        "Visit https://routiq-backend-prod.up.railway.app/docs",
        "Test authentication flow",
        "Try patient listing endpoints",
        "Check sync status endpoints",
        "Note any error responses"
      ]
    },
    {
      "task": "Identify frontend integration points",
      "frontend_needs": [
        "User authentication flow",
        "Organization context switching",
        "Patient data retrieval",
        "Real-time sync status",
        "Error handling patterns"
      ]
    }
  ],
  
  "expected_outcomes": [
    "Complete API endpoint inventory",
    "Understanding of request/response contracts",
    "Knowledge of authentication patterns",
    "Awareness of frontend integration requirements"
  ],
  
  "deliverable": "Create prod_mgmt/api_reference.md with endpoint documentation",
  "next_step": "05_integrations_and_external_services"
} 