{
  "step": "03_data_models_and_database",
  "title": "Data Models & Database Schema",
  "purpose": "Understand what data the system stores and how it's organized",
  "estimated_time": "45 minutes",
  
  "tasks": [
    {
      "task": "Review database schema",
      "files_to_review": [
        "current_db_schema.sql",
        "sql/01_create_tables.sql",
        "sql/02_create_triggers.sql",
        "sql/03_create_views.sql"
      ],
      "analysis_framework": {
        "core_entities": [
          "patients - Unified patient records",
          "organizations - Healthcare practices",
          "users - System users",
          "conversations - Communication threads",
          "messages - Individual messages",
          "appointments - Appointment records"
        ],
        "supporting_entities": [
          "service_integrations - Enabled services per org",
          "service_credentials - API keys and secrets",
          "sync_logs - Data synchronization history",
          "audit_logs - User action tracking"
        ]
      }
    },
    {
      "task": "Understand data relationships",
      "focus_areas": [
        "Organization → Patients (1:many)",
        "Patients → Appointments (1:many)",
        "Patients → Conversations (1:many)", 
        "Conversations → Messages (1:many)",
        "Organizations → Service Integrations (1:many)"
      ],
      "questions_to_answer": [
        "How is multi-tenancy handled?",
        "What are the key foreign key relationships?",
        "How is data isolation enforced?"
      ]
    },
    {
      "task": "Identify data flow patterns",
      "workflows_to_trace": [
        "Cliniko sync: External API → patients table",
        "Chatwoot sync: External API → conversations/messages",
        "User access: Authentication → organization filtering",
        "Frontend queries: API endpoints → database → JSON response"
      ]
    },
    {
      "task": "Note deprecated vs current schema",
      "legacy_elements": [
        "contacts_deprecated table - old patient storage",
        "active_patients_deprecated table - old activity tracking"
      ],
      "current_elements": [
        "patients table - unified patient storage with activity status"
      ]
    }
  ],
  
  "expected_outcomes": [
    "Clear understanding of data model",
    "Knowledge of entity relationships",
    "Awareness of multi-tenant data isolation",
    "Understanding of sync workflows"
  ],
  
  "deliverable": "Create prod_mgmt/data_model_diagram.md with entity relationships",
  "next_step": "04_api_endpoints_and_contracts"
} 